<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>StacKAT Playground</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Add CodeMirror for syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/monokai.min.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            padding: 30px;
            margin-top: 20px;
        }

        .header {
            color: #343a40;
            margin-bottom: 30px;
            margin-left: -30px;
            margin-right: -30px;
            margin-top: -30px;
            text-align: center;
            background-color: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
            padding-bottom: 15px;
            padding: 0;
            position: relative;
        }

        .header h1 {
            color: #343a40;
            text-align: center;
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 2.5rem;
            font-weight: bold;
            /* letter-spacing: -0.5px; */
            padding: 0;
            padding-top: 10px;
        }

        /* Cat logo animation */
        #cat-logo {
            transition: transform 0.3s ease;
        }

        #cat-logo:hover {
            transform: scale(1.1);
        }

        #cat-logo:active {
            transform: scale(0.95);
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .cat-bounce {
            animation: bounce 0.5s ease;
        }

        .header #links {
            font-size: 12px;
        }

        @media (min-width: 900px) {
            .header #links {
                position: absolute;
                right: 10px;
                top: 10px;
                font-size: 12px;
            }
        }

        /* Main grid layout */
        .playground-grid {
            display: grid;
            grid-template-columns: 1fr 200px 1fr;
            grid-template-rows: auto auto 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        /* Media query for mobile devices */
        @media (max-width: 768px) {
            body {
                padding: 10px;
                overflow-x: hidden;
            }

            .playground-grid {
                display: grid;
                grid-template-columns: 1fr;
                grid-template-rows: auto auto auto auto auto auto auto;
                gap: 15px;
            }

            .expression1-area {
                grid-column: 1 !important;
                grid-row: 1 !important;
                width: 100%;
            }

            .result-badge-area {
                grid-column: 1 !important;
                grid-row: 2 !important;
                padding-top: 0;
                padding-bottom: 0.5rem;
                justify-content: center;
                width: 100%;
            }

            .expression2-area {
                grid-column: 1 !important;
                grid-row: 3 !important;
                width: 100%;
            }

            .parse-error1-area {
                grid-column: 1 !important;
                grid-row: 4 !important;
                width: 100%;
            }

            .parse-error2-area {
                grid-column: 1 !important;
                grid-row: 5 !important;
                width: 100%;
            }

            .counter-example1-area {
                grid-column: 1 !important;
                grid-row: 6 !important;
                width: 100%;
            }

            .counter-example2-area {
                grid-column: 1 !important;
                grid-row: 7 !important;
                width: 100%;
            }

            .container {
                padding: 15px;
                width: 100%;
                max-width: 100%;
                overflow-x: hidden;
            }

            .header {
                margin-left: -15px;
                margin-right: -15px;
                margin-top: -15px;
            }

            .header h1 {
                font-size: 1.8rem;
            }

            .result-badge {
                width: 100%;
                max-width: 200px;
            }

            /* Make the syntax guide table responsive */
            .syntax-guide {
                overflow-x: auto;
                padding: 10px;
                margin-top: 20px;
            }

            .syntax-guide table {
                font-size: 0.9rem;
            }

            /* Adjust example pairs for mobile */
            .example-pairs-section {
                padding: 10px;
                margin-top: 20px;
            }

            .example-pairs-section .row {
                flex-direction: column;
            }

            .example-pairs-section .col-md-6 {
                width: 100%;
            }

            .example-pair-item {
                font-size: 0.8rem;
                padding: 6px 8px;
            }

            /* Adjust CodeMirror for mobile */
            .CodeMirror {
                height: 120px;
                font-size: 0.9rem;
            }

            /* Make the top right link more mobile-friendly */
            .header .toprightlink {
                font-size: 0.8rem;
                top: 5px;
                right: 5px;
            }

            /* Improve counter example display on mobile */
            .counter-example {
                padding: 10px;
            }

            .counter-example-item {
                padding: 10px;
            }

            /* Adjust result badge for better mobile display */
            .result-badge {
                font-size: 1rem;
                padding: 6px 12px;
            }

            /* Make the cat logo smaller on mobile */
            #cat-logo {
                width: 30px;
                height: 30px;
            }

            /* Ensure CodeMirror editors are properly sized */
            #editor1-container, #editor2-container {
                width: 100%;
            }

            #editor1-container .CodeMirror, #editor2-container .CodeMirror {
                width: 100%;
                height: 120px;
            }

            /* Ensure example pairs display properly */
            .example-pair-item {
                white-space: normal;
                line-height: 1.4;
            }

            .example-left, .example-right {
                max-width: 40%;
            }

            /* Fix example pairs section layout */
            .example-pairs-section {
                padding: 10px;
            }

            .example-pairs-section .row {
                display: flex;
                flex-direction: column;
            }

            .example-pairs-section .col-md-6 {
                width: 100%;
                max-width: 100%;
                flex: 0 0 100%;
            }

            /* Ensure syntax guide is scrollable on mobile */
            .syntax-guide {
                overflow-x: auto;
            }
        }

        /* Grid areas */
        .expression1-area {
            grid-column: 1;
            grid-row: 1;
        }

        .expression2-area {
            grid-column: 3;
            grid-row: 1;
        }

        .expression-title {
            text-align: center;
            font-size: 1.2rem;
            font-weight: bold;
            color: #343a40;
        }

        .expression1-area .expression-title {
            background-color: #fff3cd;
            color: #664d03;
            padding: 5px 10px;
            border-radius: 5px;
        }

        .expression2-area .expression-title {
            background-color: #cce5ff;
            color: #004085;
            padding: 5px 10px;
            border-radius: 5px;
        }

        span.left {
            background-color: #fff3cd;
            color: #664d03;
            padding: 3px 6px;
            border-radius: 5px;
        }

        span.right {
            background-color: #cce5ff;
            color: #004085;
            padding: 3px 6px;
            border-radius: 5px;
        }

        .result-badge-area {
            grid-column: 2;
            grid-row: 1;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding-top: 2.5rem;
        }

        .parse-error1-area {
            grid-column: 1;
            grid-row: 2;
        }

        .parse-error2-area {
            grid-column: 3;
            grid-row: 2;
        }

        .counter-example1-area {
            grid-column: 1;
            grid-row: 3;
        }

        .counter-example2-area {
            grid-column: 3;
            grid-row: 3;
        }

        /* Styling for elements */
        .CodeMirror {
            height: 150px;
            font-family: 'Consolas', 'Courier New', monospace;
            font-size: 1rem;
            border: 1px solid #ced4da;
            border-radius: 0.25rem;
        }

        .cm-keyword {
            color: #007bff;
            font-weight: bold;
        }

        .cm-operator {
            color: #fd7e14;
        }

        .cm-number {
            color: #28a745;
        }

        .cm-error {
            text-decoration: wavy underline #dc3545;
        }

        .result-badge {
            font-size: 1.2rem;
            padding: 8px 15px;
            border-radius: 20px;
            display: inline-block;
            width: 200px;
            text-align: center;
            white-space: nowrap;
        }

        .equal {
            background-color: #d4edda;
            color: #155724;
        }

        .left-subset {
            background-color: #cce5ff;
            color: #004085;
        }

        .right-subset {
            background-color: #fff3cd;
            color: #664d03;
        }

        .not-equal {
            background-color: #f8d7da;
            color: #721c24;
        }

        .error {
            background-color: #f8d7da;
            color: #721c24;
        }

        .parse-error {
            color: #721c24;
            font-size: 0.9rem;
            padding: 12px;
            background-color: #f8d7da;
            border-radius: 4px;
            border-left: 4px solid #dc3545;
            display: none;
            margin-top: 10px;
            font-family: 'Consolas', 'Courier New', monospace;
        }

        .error-code-snippet {
            background-color: rgba(255, 255, 255, 0.7);
            padding: 8px;
            border-radius: 3px;
            margin: 8px 0;
            white-space: pre;
            overflow-x: auto;
        }

        .error-highlight {
            background-color: rgba(220, 53, 69, 0.2);
            color: #dc3545;
            font-weight: bold;
            padding: 0 2px;
            border-radius: 2px;
        }

        .error-marker {
            position: relative;
            background-color: rgba(255, 0, 0, 0.1);
        }

        .counter-example-container {
            margin-top: 10px;
        }

        .counter-example {
            background-color: white;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .counter-example h4 {
            font-size: 1.0rem;
            margin-bottom: 10px;
            font-weight: bold;
            color: #495057;
        }

        .counter-example-details {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        #counter-example-container1 .counter-example-item {
            /* background color the same as the left expression badge */
            background-color: #fff3cd;
        }

        #counter-example-container1 code {
            color: #664d03;
        }

        #counter-example-container2 .counter-example-item {
            /* background color the same as the right expression badge */
            background-color: #cce5ff;
        }

        #counter-example-container2 code {
            color: #004085;
        }

        .counter-example-item {
            /* background-color: #f8f9fa; */
            padding: 15px;
            border-radius: 5px;
            line-height: 1.6;
        }

        .counter-example-item div {
            margin-bottom: 8px;
        }

        /* Syntax guide */
        .syntax-guide {
            margin-top: 30px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }

        .syntax-guide h3 {
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .syntax-guide table {
            width: 100%;
        }

        .syntax-guide th, .syntax-guide td {
            padding: 8px;
        }

        /* Example pairs section */
        .example-pairs-section {
            margin-top: 30px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }

        .example-pairs-section h3 {
            margin-bottom: 15px;
        }

        .example-pairs-section .card-body {
            /* max-height: 400px; */
            /* overflow-y: auto; */
        }

        .example-pair-item {
            padding: 8px 12px;
            cursor: pointer;
            font-family: monospace;
            font-size: 0.9rem;
            border-bottom: 1px solid rgba(0,0,0,0.1);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            transition: background-color 0.2s;
        }

        .example-pair-item:hover {
            background-color: rgba(0,0,0,0.05);
        }

        .example-left, .example-right {
            display: inline-block;
            max-width: 45%;
            overflow: hidden;
            text-overflow: ellipsis;
            vertical-align: middle;
        }

        /* Relationship symbols */
        .relation-equal {
            color: #155724;
            font-weight: bold;
            margin: 0 8px;
        }

        .relation-subset {
            color: #004085;
            font-weight: bold;
            margin: 0 8px;
        }

        .relation-superset {
            color: #664d03;
            font-weight: bold;
            margin: 0 8px;
        }

        .relation-incomparable {
            color: #721c24;
            font-weight: bold;
            margin: 0 8px;
        }

        /* Autocomplete styles */
        .cm-hint-container {
            z-index: 10;
        }

        .CodeMirror-hints {
            position: absolute;
            z-index: 10;
            overflow: hidden;
            list-style: none;
            margin: 0;
            padding: 2px;
            border-radius: 3px;
            border: 1px solid silver;
            background: white;
            font-size: 90%;
            max-height: 20em;
            overflow-y: auto;
        }

        .CodeMirror-hint {
            margin: 0;
            padding: 0 4px;
            border-radius: 2px;
            white-space: pre;
            color: black;
            cursor: pointer;
        }

        li.CodeMirror-hint-active {
            background: #08f;
            color: white;
        }

        code {
            color: #0056b3;
        }

        svg {
            user-select: none;
            -webkit-user-select: none; /* For Safari */
            -moz-user-select: none;    /* For Firefox */
            -ms-user-select: none;     /* For IE */
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
        <span id="links">
            <a href="https://netkat.org">NetKAT</a> |
            <a href="stackatv1.html" class="toprightlink">JS version</a> | 
            <a href="https://julesjacobs.com/papers/stackat/stackat.pdf" class="toprightlink">Paper</a> |
            <a href="slides/slides.html" class="toprightlink">Slides</a>
        </span>
        <h1>
            StacKAT
            <svg width="40" height="40" viewBox="0 0 40 40" style="margin-right: 10px; vertical-align: middle; cursor: pointer;" id="cat-logo">
                <!-- Stack layers with gradient and shadow -->
                <defs>
                    <linearGradient id="stackGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" style="stop-color:#6c757d;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#495057;stop-opacity:1" />
                    </linearGradient>
                </defs>

                <!-- Base shadow -->
                <rect x="12" y="30" width="16" height="4" fill="#00000033" rx="1"/>

                <!-- Stack layers with depth effect -->
                <rect x="8" y="26" width="24" height="6" fill="url(#stackGradient)" rx="2"
                      stroke="#343a40" stroke-width="1"/>
                <rect x="10" y="18" width="20" height="6" fill="url(#stackGradient)" rx="2"
                      stroke="#343a40" stroke-width="1"/>
                <rect x="12" y="10" width="16" height="6" fill="url(#stackGradient)" rx="2"
                      stroke="#343a40" stroke-width="1"/>
                <!-- Cat feet with gradient -->
                <!-- Left foot -->
                <rect x="12" y="34" width="6" height="4" fill="url(#stackGradient)" rx="2"
                      stroke="#343a40" stroke-width="1"/>

                <!-- Right foot -->
                <rect x="22" y="34" width="6" height="4" fill="url(#stackGradient)" rx="2"
                      stroke="#343a40" stroke-width="1"/>

                <!-- Cat ears with gradient -->
                <!-- Left ear -->
                <rect x="12" y="4.5" width="6" height="4" fill="url(#stackGradient)" rx="2"
                      stroke="#343a40" stroke-width="1"/>

                <!-- Right ear -->
                <rect x="22" y="4.5" width="6" height="4" fill="url(#stackGradient)" rx="2"
                      stroke="#343a40" stroke-width="1"/>

                <!-- Cat eyes -->
                <circle cx="16" cy="14" r="2" fill="white"/>
                <circle cx="24" cy="14" r="2" fill="white"/>
                <!-- Cat pupils -->
                <circle cx="16" cy="14" r="0.75" fill="#343a40"/>
                <circle cx="24" cy="14" r="0.75" fill="#343a40"/>

                <!-- Whiskers -->
                <line x1="8" y1="15" x2="14" y2="14" stroke="#343a40" stroke-width="0.5"/>
                <line x1="8" y1="17" x2="14" y2="16" stroke="#343a40" stroke-width="0.5"/>
                <line x1="32" y1="15" x2="26" y2="14" stroke="#343a40" stroke-width="0.5"/>
                <line x1="32" y1="17" x2="26" y2="16" stroke="#343a40" stroke-width="0.5"/>
            </svg>
            Playground
        </h1>
        </div>

        <div class="playground-grid">
            <!-- Expression 1 -->
            <div class="expression1-area">
                <h4 class="expression-title">Left expression</h4>
                <div id="editor1-container">
                    <textarea id="expression1" placeholder="Enter StacKAT expression...">(push 2)* ; (pop 2)*</textarea>
                </div>
            </div>

            <!-- Result Badge -->
            <div class="result-badge-area">
                <div id="result-badge" class="result-badge equal">Equal (=)</div>
            </div>

            <!-- Expression 2 -->
            <div class="expression2-area">
                <h4 class="expression-title">Right expression</h4>
                <div id="editor2-container">
                    <textarea id="expression2" placeholder="Enter StacKAT expression...">(push 2 + pop 2)*</textarea>
                </div>
            </div>

            <!-- Parse Errors -->
            <div class="parse-error1-area">
                <div id="parse-error1" class="parse-error"></div>
            </div>

            <div class="parse-error2-area">
                <div id="parse-error2" class="parse-error"></div>
            </div>

            <!-- Counter Examples -->
            <div class="counter-example1-area">
                <div id="counter-example-container1" class="counter-example-container"></div>
            </div>

            <div class="counter-example2-area">
                <div id="counter-example-container2" class="counter-example-container"></div>
            </div>
        </div>

        <div class="syntax-guide">
            <h3>Syntax Guide</h3>
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>Operation</th>
                        <th>Syntax</th>
                        <th>Example</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Zero (Drop)</td>
                        <td><code>0</code></td>
                        <td><code>0</code></td>
                    </tr>
                    <tr>
                        <td>One (Identity)</td>
                        <td><code>1</code></td>
                        <td><code>1</code></td>
                    </tr>
                    <tr>
                        <td>Push</td>
                        <td><code>push value</code></td>
                        <td><code>push 42</code></td>
                    </tr>
                    <tr>
                        <td>Pop</td>
                        <td><code>pop value</code></td>
                        <td><code>pop 42</code></td>
                    </tr>
                    <tr>
                        <td>Test</td>
                        <td><code>field == value</code></td>
                        <td><code>ip == 192</code></td>
                    </tr>
                    <tr>
                        <td>Not Equal Test</td>
                        <td><code>field != value</code></td>
                        <td><code>ip != 192</code></td>
                    </tr>
                    <tr>
                        <td>Modify</td>
                        <td><code>field := value</code></td>
                        <td><code>port := 80</code></td>
                    </tr>
                    <tr>
                        <td>Sequence</td>
                        <td><code>expr1 ; expr2</code></td>
                        <td><code>push 1 ; pop 1</code></td>
                    </tr>
                    <tr>
                        <td>Alternative</td>
                        <td><code>expr1 + expr2</code></td>
                        <td><code>push 1 + pop 1</code></td>
                    </tr>
                    <tr>
                        <td>Kleene Star</td>
                        <td><code>(expr)*</code></td>
                        <td><code>(push 1)*</code></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="example-pairs-section">
            <h3>Example Expression Pairs</h3>
            <p>Click on the cat logo at the top to load a random example pair, or click on any pair below to load it.</p>
            <div class="row" id="example-pairs-container">
                <!-- Example pairs with new layout -->
                <div class="col-md-6 mb-4">
                    <div class="card border-success h-100">
                        <div class="card-header bg-success text-white">Equal (=)</div>
                        <div class="card-body p-0" id="equal-examples">
                            <!-- Equal examples will be loaded here -->
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card border-primary mb-3">
                        <div class="card-header bg-primary text-white">Right is greater (⊂)</div>
                        <div class="card-body p-0" id="left-subset-examples">
                            <!-- Left subset examples will be loaded here -->
                        </div>
                    </div>
                    <div class="card border-warning mb-3">
                        <div class="card-header bg-warning text-white">Left is greater (⊃)</div>
                        <div class="card-body p-0" id="right-subset-examples">
                            <!-- Right subset examples will be loaded here -->
                        </div>
                    </div>
                    <div class="card border-danger mb-3">
                        <div class="card-header bg-danger text-white">Incomparable (≠)</div>
                        <div class="card-body p-0" id="not-equal-examples">
                            <!-- Not equal examples will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Add CodeMirror scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/hint/show-hint.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/matchbrackets.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/closebrackets.min.js"></script>

    <script>
        // Example pairs without pre-computed results
        const examplePairs = [
            // From unit tests
            { left: "push 2 ; pop 2", right: "push 2 ; pop 2" },
            { left: "(push 2)* ; (pop 2)*", right: "(push 2)* + (pop 2)*" },
            { left: "(push 2)* ; (pop 2)*", right: "(push 2)*" },
            { left: "(push 2)* ; (pop 2)*", right: "(push 3)* ; (pop 3)*" },
            { left: "(push 2)* ; pop 2", right: "(push 2)* ; (pop 2)*" },
            { left: "(pop 2)* ; (push 2)*", right: "(push 2 + pop 2)*" },
            { left: "(push 2)* ; (pop 2 ; pop 2)*", right: "(pop 2 ; pop 2)* ; (push 2)*" },
            { left: "(push 2 ; push 2)* ; (pop 2)*", right: "(pop 2)* ; (push 2 ; push 2)*" },
            { left: "(pop 2)* ; (push 2 ; push 2)*", right: "(pop 2 ; pop 2)* ; (push 2)*" },
            { left: "(pop 2)* ; (push 2 ; push 2)*", right: "(push 2 ; push 2)*" },
            { left: "(pop 2)* ; (push 2 ; push 2)*", right: "(pop 2 ; pop 2)*" },
            { left: "(pop 2 ; pop 2)* ; (push 2)*", right: "(push 2 ; push 2)* ; (pop 2)*" },
            { left: "(push 2)* ; (pop 2)*", right: "(push 2 ; pop 2)*" },
            { left: "(push 2)* ; (pop 2)*", right: "(push 2)* ; (pop 2)* ; (push 2)*" },
            { left: "(push 2)* ; (pop 2)*", right: "(push 2)* ; (pop 2)* ; (pop 2)*" },
            { left: "(push 2)* ; (pop 2)*", right: "(push 2)* ; (pop 2)* ; (push 2)* ; (pop 2)*" },
            { left: "(push 2)* ; (pop 2)*", right: "(push 2 ; pop 2)*" },
            { left: "(push 2)* ; (pop 2)*", right: "(push 2)* ; (pop 2)* ; (push 3)* ; (pop 3)*" },
            { left: "(push 2)* ; (pop 2)*", right: "(push 2)* ; (pop 2)* ; (push 3)* ; (pop 3)*" },
            { left: "(push 2)* ; (pop 2)*", right: "(push 2)* ; (pop 2)* ; (push 3)* ; (pop 3)*" },

            // From stackatv1.html
            { left: "(pop 2)* ; (push 2)*", right: "(push 2 + pop 2)*" },
            { left: "(pop 2)* ; (push 2)*", right: "(push 2)* ; (pop 2 ; pop 2)*" },
            { left: "(pop 2)* ; (push 2)*", right: "(pop 2 ; pop 2)* ; (push 2)*" },
            { left: "(pop 2)* ; (push 2)*", right: "(push 2 ; push 2)* ; (pop 2)*" },
            { left: "(pop 2)* ; (push 2)*", right: "(pop 2)* ; (push 2 ; push 2)*" },
            { left: "(push 2 + pop 2)*", right: "(push 2)* ; (pop 2 ; pop 2)*" },
            { left: "(push 2 + pop 2)*", right: "(pop 2 ; pop 2)* ; (push 2)*" },
            { left: "(push 2 + pop 2)*", right: "(push 2 ; push 2)* ; (pop 2)*" },
            { left: "(push 2 + pop 2)*", right: "(pop 2)* ; (push 2 ; push 2)*" },
            { left: "(push 2)* ; (pop 2 ; pop 2)*", right: "(pop 2 ; pop 2)* ; (push 2)*" },
            { left: "(push 2)* ; (pop 2 ; pop 2)*", right: "(push 2 ; push 2)* ; (pop 2)*" },
            { left: "(push 2)* ; (pop 2 ; pop 2)*", right: "(pop 2)* ; (push 2 ; push 2)*" },
            { left: "(pop 2 ; pop 2)* ; (push 2)*", right: "(push 2 ; push 2)* ; (pop 2)*" },
            { left: "(pop 2 ; pop 2)* ; (push 2)*", right: "(pop 2)* ; (push 2 ; push 2)*" },
            { left: "(push 2 ; push 2)* ; (pop 2)*", right: "(pop 2)* ; (push 2 ; push 2)*" },

            // Pure headers examples
            { left: "f:=2 ; g:=3", right: "g:=3 ; f:=2" },
            { left: "f:=2 ; f==2", right: "f:=2 ; f:=2" },
            { left: "(f:=2)* ; g:=3", right: "g:=3 ; (f:=2)*" },
            { left: "(f:=2 + g:=3)*", right: "(g:=3 + f:=2)*" },
            { left: "(f:=2)* ; (g:=3)*", right: "(g:=3)* ; (f:=2)*" },
            { left: "(f:=2 + g:=3) ; (f:=4)*", right: "(g:=3 + f:=2) ; (f:=4)*" },
            { left: "(f:=2)* ; (g:=3 + h:=4)", right: "(f:=2)* ; (h:=4 + g:=3)" },
            { left: "(f:=2 + g:=3)* ; h:=4", right: "h:=4 ; (f:=2 + g:=3)*" },
            { left: "(f:=2)* ; (g:=3 + h:=4)*", right: "(g:=3 + h:=4)* ; (f:=2)*" },
            { left: "f:=2 + f:=3", right: "f:=2 + f:=2" },
            { left: "f:=2 + f==2", right: "f:=2" },
            { left: "(f:=3)*", right: "(f:=2)*" },
            { left: "(f:=2 + f:=3)*", right: "(f:=2 + f:=2)*" },

            // Mixed headers examples
            { left: "pop 3 ; f:=2 ; push 2 ; pop 2 ; f:=3", right: "f:=3 ; pop 3" },

            // More interesting examples
            { left: "f := 1 ; (f == 1 ; f := 2 ; push 1 + f == 2 ; f := 3 ; push 2)* ; f == 3", right: "f := 1 ; f := 3 ; push 1 ; push 2" },
            { left: "f := 1 ; (f == 1 ; push 1 + f == 1 ; pop 1)* ; f := 2", right: "f := 1 ; (push 1 + pop 1)* ; f := 2" },
            { left: "f := 2 ; (push 1)* ; (f == 2 ; pop 1)*", right: "f := 2 ; (push 1 + pop 1)*" },
            { left: "f := 1 ; (push 1)* ; f := 2", right: "f := 1 ; (push 1 + push 2)* ; f := 2" }
        ];

        // Computed results for each example pair
        let computedResults = [];

        // Function to compute the equivalence result for a pair
        function computeEquivalence(pair) {
            try {
                if (window.stackat && window.stackat.checkEquivalence) {
                    const result = window.stackat.checkEquivalence(pair.left, pair.right, [], []);
                    return result.comparison;
                }
                return null;
            } catch (error) {
                console.error('Error computing equivalence:', error);
                return null;
            }
        }

        // Function to initialize computed results
        function initializeComputedResults() {
            
            console.log('Computing equivalence results for all example pairs...');
            computedResults = examplePairs.map(pair => ({
                ...pair,
                result: computeEquivalence(pair)
            }));
            console.log('Finished computing equivalence results');

            // Populate the example pairs UI
            populateExamplePairs();
        }

        // Function to load a random example
        function loadRandomExample() {
            // document.activeElement.blur();

            // Get a random example pair
            const randomIndex = Math.floor(Math.random() * examplePairs.length);
            const example = examplePairs[randomIndex];

            // Add bounce animation to cat logo
            const catLogo = document.getElementById('cat-logo');
            catLogo.classList.add('cat-bounce');
            setTimeout(() => catLogo.classList.remove('cat-bounce'), 500);

            // Completely disable the decision procedure
            let decisionProcedureWasEnabled = true;
            if (window.app) {
                // Store the current state of the decision procedure
                decisionProcedureWasEnabled = window.app.decisionProcedureEnabled !== false;

                // Disable change handlers
                window.app.disableChangeHandlers();

                // Disable the decision procedure completely
                window.app.decisionProcedureEnabled = false;

                // Set the values in the editors
                window.app.editor1.setValue(example.left);
                window.app.editor2.setValue(example.right);

                // Re-enable change handlers but keep decision procedure disabled
                window.app.enableChangeHandlers();

                // Re-enable the decision procedure and trigger evaluation after a delay
                setTimeout(() => {
                    window.app.decisionProcedureEnabled = decisionProcedureWasEnabled;
                    if (decisionProcedureWasEnabled && window.app.checkEquivalence) {
                        window.app.checkEquivalence();
                    }
                }, 100);
            }

            // Scroll to the top of the page
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }

        // Function to populate example pairs
        function populateExamplePairs() {
            const equalContainer = document.getElementById('equal-examples');
            const leftSubsetContainer = document.getElementById('left-subset-examples');
            const rightSubsetContainer = document.getElementById('right-subset-examples');
            const notEqualContainer = document.getElementById('not-equal-examples');

            // Clear containers
            equalContainer.innerHTML = '';
            leftSubsetContainer.innerHTML = '';
            rightSubsetContainer.innerHTML = '';
            notEqualContainer.innerHTML = '';

            // Group examples by computed result
            computedResults.forEach(pair => {
                if (!pair.result) return; // Skip pairs with no computed result

                const item = document.createElement('div');
                item.className = 'example-pair-item';

                // Format the display with the appropriate relationship symbol
                let relationSymbol = '';
                let relationClass = '';

                switch (pair.result) {
                    case 'Equal':
                        relationSymbol = '=';
                        relationClass = 'relation-equal';
                        break;
                    case 'LeftIsSubset':
                        relationSymbol = '⊂';
                        relationClass = 'relation-subset';
                        break;
                    case 'RightIsSubset':
                        relationSymbol = '⊃';
                        relationClass = 'relation-superset';
                        break;
                    case 'NotEqual':
                        relationSymbol = '≠';
                        relationClass = 'relation-incomparable';
                        break;
                }

                item.innerHTML = `<span class="example-left">${pair.left}</span> <span class="${relationClass}">${relationSymbol}</span> <span class="example-right">${pair.right}</span>`;

                // Add click event to load this example
                item.addEventListener('click', () => {
                    // Completely disable the decision procedure
                    let decisionProcedureWasEnabled = true;
                    if (window.app) {
                        // Store the current state of the decision procedure
                        decisionProcedureWasEnabled = window.app.decisionProcedureEnabled !== false;

                        // Disable change handlers
                        window.app.disableChangeHandlers();

                        // Disable the decision procedure completely
                        window.app.decisionProcedureEnabled = false;

                        // Set the values in the editors
                        window.app.editor1.setValue(pair.left);
                        window.app.editor2.setValue(pair.right);

                        // Re-enable change handlers but keep decision procedure disabled
                        window.app.enableChangeHandlers();

                        // Re-enable the decision procedure and trigger evaluation after a delay
                        setTimeout(() => {
                            window.app.decisionProcedureEnabled = decisionProcedureWasEnabled;
                            if (decisionProcedureWasEnabled && window.app.checkEquivalence) {
                                window.app.checkEquivalence();
                            }
                        }, 100);
                    }

                    // Scroll to the top of the page
                    window.scrollTo({
                        top: 0,
                        behavior: 'smooth'
                    });
                });

                // Add to appropriate container based on computed result
                switch (pair.result) {
                    case 'Equal':
                        equalContainer.appendChild(item);
                        break;
                    case 'LeftIsSubset':
                        leftSubsetContainer.appendChild(item);
                        break;
                    case 'RightIsSubset':
                        rightSubsetContainer.appendChild(item);
                        break;
                    case 'NotEqual':
                        notEqualContainer.appendChild(item);
                        break;
                }
            });
        }

        // Add event listener to cat logo and initialize results when WASM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            const catLogo = document.getElementById('cat-logo');
            if (catLogo) {
                catLogo.addEventListener('mousedown', loadRandomExample);
                catLogo.title = "Click to load a random example";
            }

            // Initialize computed results when WASM is loaded
            if (window.stackat && window.stackat.checkEquivalence) {
                initializeComputedResults();
            } else {
                // If WASM is not loaded yet, wait for it
                document.addEventListener('stackat-wasm-loaded', initializeComputedResults);
            }
        });
    </script>

    <script type="module" src="./stackat_wasm_loader.js"></script>
    <script src="app.js"></script>
</body>
</html>